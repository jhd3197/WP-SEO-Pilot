"use strict";(globalThis.webpackChunksaman_labs_seo=globalThis.webpackChunksaman_labs_seo||[]).push([[113],{113(e,t,a){a.r(t),a.d(t,{default:()=>m});var l=a(609),n=a(87),r=a(455),s=a.n(r);const c=[{value:301,label:"301 Permanent"},{value:302,label:"302 Temporary"},{value:307,label:"307"},{value:410,label:"410 Gone"}],o={source:"",target:"",status_code:301,is_regex:!1,group_name:"",start_date:"",end_date:"",notes:""},m=()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0),[m,i]=(0,n.useState)({page:1,per_page:50,total:0,total_pages:1}),[d,u]=(0,n.useState)({...o}),[p,g]=(0,n.useState)(null),[E,h]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),[y,N]=(0,n.useState)(""),[f,k]=(0,n.useState)([]),[_,C]=(0,n.useState)(!1),[S,w]=(0,n.useState)(""),[x,T]=(0,n.useState)(""),[R,F]=(0,n.useState)(""),[L,O]=(0,n.useState)([]),[D,P]=(0,n.useState)([]),[A,U]=(0,n.useState)(!1),[$,j]=(0,n.useState)(!1),[I,B]=(0,n.useState)(""),[G,H]=(0,n.useState)("json"),[J,V]=(0,n.useState)(!1),[q,M]=(0,n.useState)(!1),[W,z]=(0,n.useState)(null),[K,Q]=(0,n.useState)([]),[X,Y]=(0,n.useState)(!0),Z=(0,n.useRef)(null),ee=(0,n.useCallback)(async(e=1)=>{r(!0);try{const a=new URLSearchParams;a.append("page",e),a.append("per_page",m.per_page),S&&a.append("search",S),x&&a.append("group",x),R&&a.append("status_code",R);const l=await s()({path:`/samanlabs-seo/v1/redirects?${a}`});l.success&&(t(l.data.items||[]),i(e=>({...e,page:l.data.page,total:l.data.total,total_pages:l.data.total_pages})))}catch(e){console.error("Failed to fetch redirects:",e)}finally{r(!1)}},[S,x,R,m.per_page]),te=(0,n.useCallback)(async()=>{try{const e=await s()({path:"/samanlabs-seo/v1/redirects/groups"});e.success&&O(e.data||[])}catch(e){console.error("Failed to fetch groups:",e)}},[]),ae=(0,n.useCallback)(async()=>{Y(!0);try{const e=await s()({path:"/samanlabs-seo/v1/slug-suggestions"});e.success&&Q(e.data)}catch(e){console.error("Failed to fetch suggestions:",e)}finally{Y(!1)}},[]);(0,n.useEffect)(()=>{ee(),te(),ae();const e=sessionStorage.getItem("samanlabs_seo_redirect_source");e&&(u(t=>({...t,source:e})),h(!0),sessionStorage.removeItem("samanlabs_seo_redirect_source"))},[]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{ee(1)},300);return()=>clearTimeout(e)},[S,x,R]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{(async(e,t)=>{if(e&&t)try{const a=await s()({path:"/samanlabs-seo/v1/redirects/validate-chain",method:"POST",data:{source:e,target:t,exclude_id:p||0}});a.success&&k(a.data.warnings||[])}catch(e){console.error("Chain validation failed:",e)}})(d.source,d.target)},500);return()=>clearTimeout(e)},[d.source,d.target]);const le=(e,t)=>{u(a=>({...a,[e]:t})),N("")},ne=()=>{u({...o}),g(null),h(!0),k([]),C(!1),N("")},re=()=>{h(!1),g(null),u({...o}),k([]),N("")},se=async e=>{try{const t=await s()({path:`/samanlabs-seo/v1/redirects/export?format=${e}`});if(t.success){const a=new Blob([t.data.content],{type:"json"===e?"application/json":"text/csv"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=t.data.filename,n.click(),URL.revokeObjectURL(l)}}catch(e){console.error("Export failed:",e)}},ce=e=>e?new Date(e).toLocaleDateString():null;return(0,l.createElement)("div",{className:"page"},(0,l.createElement)("div",{className:"page-header"},(0,l.createElement)("div",null,(0,l.createElement)("h1",null,"Redirects"),(0,l.createElement)("p",null,"Create and manage URL redirects to maintain SEO value when URLs change.")),(0,l.createElement)("div",{className:"page-header-actions"},(0,l.createElement)("button",{type:"button",className:"button ghost",onClick:()=>j(!0)},"Import"),(0,l.createElement)("div",{className:"dropdown"},(0,l.createElement)("button",{type:"button",className:"button ghost"},"Export"),(0,l.createElement)("div",{className:"dropdown-menu"},(0,l.createElement)("button",{onClick:()=>se("json")},"Export as JSON"),(0,l.createElement)("button",{onClick:()=>se("csv")},"Export as CSV"))),(0,l.createElement)("button",{type:"button",className:"button primary",onClick:ne},"Add Redirect"))),(0,l.createElement)("section",{className:"panel"},!X&&K.length>0&&(0,l.createElement)("div",{className:"alert-card warning",style:{marginBottom:"24px"}},(0,l.createElement)("div",{className:"alert-header"},(0,l.createElement)("h3",null,"Detected Slug Changes")),(0,l.createElement)("p",{className:"muted"},"The following posts have changed their URL structure. Create redirects to prevent 404 errors."),(0,l.createElement)("table",{className:"data-table suggestions-table"},(0,l.createElement)("thead",null,(0,l.createElement)("tr",null,(0,l.createElement)("th",null,"Old Path"),(0,l.createElement)("th",null,"New Target"),(0,l.createElement)("th",null,"Actions"))),(0,l.createElement)("tbody",null,K.map(e=>(0,l.createElement)("tr",{key:e.key},(0,l.createElement)("td",null,(0,l.createElement)("code",null,e.source)),(0,l.createElement)("td",null,(0,l.createElement)("a",{href:e.target,target:"_blank",rel:"noopener noreferrer"},e.target)),(0,l.createElement)("td",{className:"action-buttons"},(0,l.createElement)("button",{type:"button",className:"button primary small",onClick:()=>(async e=>{try{(await s()({path:`/samanlabs-seo/v1/slug-suggestions/${e}/apply`,method:"POST"})).success&&(Q(K.filter(t=>t.key!==e)),ee())}catch(e){console.error("Failed to apply suggestion:",e)}})(e.key)},"Apply"),(0,l.createElement)("button",{type:"button",className:"button ghost small",onClick:()=>(e=>{u(t=>({...t,source:e.source,target:e.target,status_code:301})),h(!0)})(e)},"Edit"),(0,l.createElement)("button",{type:"button",className:"link-button danger",onClick:()=>(async e=>{try{await s()({path:`/samanlabs-seo/v1/slug-suggestions/${e}/dismiss`,method:"POST"}),Q(K.filter(t=>t.key!==e))}catch(e){console.error("Failed to dismiss suggestion:",e)}})(e.key)},"Dismiss"))))))),(0,l.createElement)("div",{className:"table-toolbar"},(0,l.createElement)("div",{className:"table-toolbar-filters"},(0,l.createElement)("input",{type:"search",placeholder:"Search redirects...",value:S,onChange:e=>w(e.target.value),className:"search-input"}),(0,l.createElement)("select",{value:x,onChange:e=>T(e.target.value)},(0,l.createElement)("option",{value:""},"All Groups"),L.map(e=>(0,l.createElement)("option",{key:e,value:e},e))),(0,l.createElement)("select",{value:R,onChange:e=>F(e.target.value)},(0,l.createElement)("option",{value:""},"All Status"),c.map(e=>(0,l.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,l.createElement)("div",{className:"table-toolbar-info"},(0,l.createElement)("span",{className:"muted"},m.total," redirect",1!==m.total?"s":""))),D.length>0&&(0,l.createElement)("div",{className:"bulk-actions"},(0,l.createElement)("span",null,D.length," selected"),(0,l.createElement)("button",{type:"button",className:"button danger small",onClick:async()=>{if(0!==D.length&&window.confirm(`Delete ${D.length} selected redirect(s)?`)){U(!0);try{await s()({path:"/samanlabs-seo/v1/redirects/bulk-delete",method:"POST",data:{ids:D}}),P([]),ee(m.page),te()}catch(e){console.error("Failed to bulk delete:",e)}finally{U(!1)}}},disabled:A},A?"Deleting...":"Delete Selected"),(0,l.createElement)("button",{type:"button",className:"link-button",onClick:()=>P([])},"Clear Selection")),a?(0,l.createElement)("div",{className:"loading-state"},"Loading redirects..."):0===e.length?(0,l.createElement)("div",{className:"empty-state"},(0,l.createElement)("div",{className:"empty-state__icon"},(0,l.createElement)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",width:"48",height:"48"},(0,l.createElement)("path",{d:"M9 18l6-6-6-6"}),(0,l.createElement)("path",{d:"M15 6l-6 6 6 6",opacity:"0.5"}))),(0,l.createElement)("h3",null,"No redirects found"),(0,l.createElement)("p",null,S||x||R?"Try adjusting your filters.":"Add your first redirect to get started."),!S&&!x&&!R&&(0,l.createElement)("button",{type:"button",className:"button primary",onClick:ne},"Add Redirect")):(0,l.createElement)(l.Fragment,null,(0,l.createElement)("table",{className:"data-table"},(0,l.createElement)("thead",null,(0,l.createElement)("tr",null,(0,l.createElement)("th",{className:"checkbox-col"},(0,l.createElement)("input",{type:"checkbox",checked:D.length===e.length&&e.length>0,onChange:()=>{D.length===e.length?P([]):P(e.map(e=>e.id))}})),(0,l.createElement)("th",null,"Source"),(0,l.createElement)("th",null,"Target"),(0,l.createElement)("th",null,"Status"),(0,l.createElement)("th",null,"Hits"),(0,l.createElement)("th",null,"Last Hit"),(0,l.createElement)("th",null,"Actions"))),(0,l.createElement)("tbody",null,e.map(e=>(0,l.createElement)("tr",{key:e.id,className:e.is_active?"":"inactive-row"},(0,l.createElement)("td",{className:"checkbox-col"},(0,l.createElement)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{return t=e.id,void P(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}})),(0,l.createElement)("td",null,(0,l.createElement)("code",null,e.source),e.is_regex&&(0,l.createElement)("span",{className:"pill info small",style:{marginLeft:"6px"}},"Regex"),e.group_name&&(0,l.createElement)("span",{className:"pill muted small",style:{marginLeft:"6px"}},e.group_name)),(0,l.createElement)("td",null,(0,l.createElement)("a",{href:e.target,target:"_blank",rel:"noopener noreferrer",className:"truncate-link"},e.target)),(0,l.createElement)("td",null,(0,l.createElement)("span",{className:"pill "+(301===e.status_code?"success":410===e.status_code?"danger":"warning")},e.status_code)),(0,l.createElement)("td",null,e.hits),(0,l.createElement)("td",null,(e=>{if(!e||"0000-00-00 00:00:00"===e)return"-";const t=new Date(e);return t.toLocaleDateString()+", "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(e.last_hit),!e.is_active&&(0,l.createElement)("div",{className:"text-muted text-small"},e.start_date&&new Date(e.start_date)>new Date?`Starts: ${ce(e.start_date)}`:`Ended: ${ce(e.end_date)}`)),(0,l.createElement)("td",{className:"action-buttons"},(0,l.createElement)("button",{type:"button",className:"link-button",onClick:()=>(e=>{u({source:e.source||"",target:e.target||"",status_code:e.status_code||301,is_regex:e.is_regex||!1,group_name:e.group_name||"",start_date:e.start_date?e.start_date.slice(0,16):"",end_date:e.end_date?e.end_date.slice(0,16):"",notes:e.notes||""}),g(e.id),h(!0),k([]),C(!!e.start_date||!!e.end_date||!!e.notes),N("")})(e)},"Edit"),(0,l.createElement)("button",{type:"button",className:"link-button danger",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this redirect?"))try{await s()({path:`/samanlabs-seo/v1/redirects/${e}`,method:"DELETE"}),ee(m.page),te()}catch(e){console.error("Failed to delete redirect:",e)}})(e.id)},"Delete")))))),m.total_pages>1&&(0,l.createElement)("div",{className:"pagination"},(0,l.createElement)("button",{type:"button",className:"button ghost small",disabled:m.page<=1,onClick:()=>ee(m.page-1)},"Previous"),(0,l.createElement)("span",{className:"pagination-info"},"Page ",m.page," of ",m.total_pages),(0,l.createElement)("button",{type:"button",className:"button ghost small",disabled:m.page>=m.total_pages,onClick:()=>ee(m.page+1)},"Next")))),E&&(0,l.createElement)("div",{className:"modal-overlay",onClick:re},(0,l.createElement)("div",{className:"modal",onClick:e=>e.stopPropagation()},(0,l.createElement)("div",{className:"modal-header"},(0,l.createElement)("h2",null,p?"Edit Redirect":"Add Redirect"),(0,l.createElement)("button",{type:"button",className:"modal-close",onClick:re},"×")),(0,l.createElement)("form",{onSubmit:async e=>{e.preventDefault(),v(!0),N("");try{const e={...d};let t;e.start_date||(e.start_date=null),e.end_date||(e.end_date=null),t=p?await s()({path:`/samanlabs-seo/v1/redirects/${p}`,method:"PUT",data:e}):await s()({path:"/samanlabs-seo/v1/redirects",method:"POST",data:e}),t.success?(re(),ee(m.page),te(),ae()):N(t.message||"Failed to save redirect")}catch(e){N(e.message||"Failed to save redirect")}finally{v(!1)}}},(0,l.createElement)("div",{className:"modal-body"},f.length>0&&(0,l.createElement)("div",{className:"chain-warnings"},f.map((e,t)=>(0,l.createElement)("div",{key:t,className:"alert-inline "+("loop"===e.type?"danger":"warning")},e.message))),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-source"},"Source Path"),(0,l.createElement)("input",{type:"text",id:"modal-source",placeholder:d.is_regex?"^/old-path/(.*)$":"/old-url",value:d.source,onChange:e=>le("source",e.target.value),required:!0}),(0,l.createElement)("label",{className:"checkbox-label"},(0,l.createElement)("input",{type:"checkbox",checked:d.is_regex,onChange:e=>le("is_regex",e.target.checked)}),"Use regex pattern"),d.is_regex&&(0,l.createElement)("p",{className:"field-hint"},"Use capture groups like (.*) and reference them in target as $1, $2, etc.")),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-target"},"Target URL"),(0,l.createElement)("input",{type:"text",id:"modal-target",placeholder:d.is_regex?"https://example.com/new-path/$1":"https://example.com/new-url",value:d.target,onChange:e=>le("target",e.target.value),required:!0})),(0,l.createElement)("div",{className:"form-row"},(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-status"},"Status Code"),(0,l.createElement)("select",{id:"modal-status",value:d.status_code,onChange:e=>le("status_code",parseInt(e.target.value,10))},c.map(e=>(0,l.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-group"},"Group (optional)"),(0,l.createElement)("input",{type:"text",id:"modal-group",placeholder:"e.g., migration, campaign",value:d.group_name,onChange:e=>le("group_name",e.target.value),list:"group-suggestions"}),(0,l.createElement)("datalist",{id:"group-suggestions"},L.map(e=>(0,l.createElement)("option",{key:e,value:e}))))),(0,l.createElement)("button",{type:"button",className:"link-button advanced-toggle",onClick:()=>C(!_)},_?"Hide Advanced Options":"Show Advanced Options"),_&&(0,l.createElement)("div",{className:"advanced-options"},(0,l.createElement)("div",{className:"form-row"},(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-start-date"},"Start Date (optional)"),(0,l.createElement)("input",{type:"datetime-local",id:"modal-start-date",value:d.start_date,onChange:e=>le("start_date",e.target.value)}),(0,l.createElement)("p",{className:"field-hint"},"Redirect activates at this time")),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-end-date"},"End Date (optional)"),(0,l.createElement)("input",{type:"datetime-local",id:"modal-end-date",value:d.end_date,onChange:e=>le("end_date",e.target.value)}),(0,l.createElement)("p",{className:"field-hint"},"Redirect expires after this time"))),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{htmlFor:"modal-notes"},"Notes (optional)"),(0,l.createElement)("textarea",{id:"modal-notes",placeholder:"Internal notes about this redirect...",value:d.notes,onChange:e=>le("notes",e.target.value),rows:"2"}))),y&&(0,l.createElement)("p",{className:"form-error"},y)),(0,l.createElement)("div",{className:"modal-footer"},(0,l.createElement)("button",{type:"button",className:"button ghost",onClick:re},"Cancel"),(0,l.createElement)("button",{type:"submit",className:"button primary",disabled:b},b?"Saving...":p?"Update Redirect":"Add Redirect"))))),$&&(0,l.createElement)("div",{className:"modal-overlay",onClick:()=>j(!1)},(0,l.createElement)("div",{className:"modal modal-wide",onClick:e=>e.stopPropagation()},(0,l.createElement)("div",{className:"modal-header"},(0,l.createElement)("h2",null,"Import Redirects"),(0,l.createElement)("button",{type:"button",className:"modal-close",onClick:()=>j(!1)},"×")),(0,l.createElement)("div",{className:"modal-body"},(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",null,"Upload File"),(0,l.createElement)("input",{type:"file",ref:Z,accept:".json,.csv",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=e=>{B(e.target.result),H(t.name.endsWith(".csv")?"csv":"json")},a.readAsText(t)}})),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",null,"Or paste data directly"),(0,l.createElement)("textarea",{value:I,onChange:e=>B(e.target.value),placeholder:"Paste JSON or CSV data here...",rows:"8",className:"code-textarea"})),(0,l.createElement)("div",{className:"form-row"},(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",null,"Format"),(0,l.createElement)("select",{value:G,onChange:e=>H(e.target.value)},(0,l.createElement)("option",{value:"json"},"JSON"),(0,l.createElement)("option",{value:"csv"},"CSV"))),(0,l.createElement)("div",{className:"form-group"},(0,l.createElement)("label",{className:"checkbox-label",style:{marginTop:"28px"}},(0,l.createElement)("input",{type:"checkbox",checked:J,onChange:e=>V(e.target.checked)}),"Overwrite existing redirects"))),W&&(0,l.createElement)("div",{className:"import-result "+(W.error?"error":"success")},W.error?(0,l.createElement)("p",null,"Error: ",W.error):(0,l.createElement)(l.Fragment,null,(0,l.createElement)("p",null,"Imported: ",W.imported," | Skipped: ",W.skipped),W.errors?.length>0&&(0,l.createElement)("ul",{className:"import-errors"},W.errors.slice(0,5).map((e,t)=>(0,l.createElement)("li",{key:t},e)),W.errors.length>5&&(0,l.createElement)("li",null,"...and ",W.errors.length-5," more"))))),(0,l.createElement)("div",{className:"modal-footer"},(0,l.createElement)("button",{type:"button",className:"button ghost",onClick:()=>j(!1)},"Close"),(0,l.createElement)("button",{type:"button",className:"button primary",onClick:async()=>{if(I.trim()){M(!0),z(null);try{const e=await s()({path:"/samanlabs-seo/v1/redirects/import",method:"POST",data:{format:G,data:I,overwrite:J}});e.success?(z(e.data),ee(1),te()):z({error:e.message})}catch(e){z({error:e.message})}finally{M(!1)}}},disabled:q||!I.trim()},q?"Importing...":"Import")))))}}}]);