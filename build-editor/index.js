(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,l=window.wp.plugins,o=window.wp.editPost,a=window.wp.data,s=window.wp.element,i=window.wp.apiFetch;var r=e.n(i);const n=window.wp.components,c=({title:e,description:l,url:o})=>{const a=e.length>60?e.substring(0,57)+"...":e,s=l.length>160?l.substring(0,157)+"...":l||"No description provided. Add a meta description to control what appears here.";return(0,t.createElement)("div",{className:"wpseopilot-search-preview"},(0,t.createElement)("div",{className:"wpseopilot-search-preview__breadcrumb"},(0,t.createElement)("div",{className:"wpseopilot-search-preview__favicon"},(0,t.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},(0,t.createElement)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,t.createElement)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))),(0,t.createElement)("div",{className:"wpseopilot-search-preview__url-container"},(0,t.createElement)("span",{className:"wpseopilot-search-preview__site-name"},(()=>{try{return new URL(o).hostname.replace("www.","")}catch{return"example.com"}})()),(0,t.createElement)("span",{className:"wpseopilot-search-preview__url"},(e=>{try{const t=new URL(e),l="/"===t.pathname?"":t.pathname;return`${t.hostname}${l}`}catch{return e}})(o))),(0,t.createElement)("button",{type:"button",className:"wpseopilot-search-preview__menu","aria-label":"More options"},(0,t.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},(0,t.createElement)("circle",{cx:"12",cy:"5",r:"1.5",fill:"currentColor"}),(0,t.createElement)("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"}),(0,t.createElement)("circle",{cx:"12",cy:"19",r:"1.5",fill:"currentColor"})))),(0,t.createElement)("h3",{className:"wpseopilot-search-preview__title"},a||"Page Title"),(0,t.createElement)("p",{className:"wpseopilot-search-preview__description"},s))},p={excellent:"#00a32a",good:"#00a32a",fair:"#dba617",poor:"#d63638"},m=({score:e=0,level:l="poor"})=>{const o=p[l]||p.poor,a=2*Math.PI*20,s=a-e/100*a;return(0,t.createElement)("div",{className:"wpseopilot-gauge"},(0,t.createElement)("svg",{viewBox:"0 0 48 48",className:"wpseopilot-gauge__svg"},(0,t.createElement)("circle",{className:"wpseopilot-gauge__bg",cx:"24",cy:"24",r:"20",fill:"none",strokeWidth:"4"}),(0,t.createElement)("circle",{className:"wpseopilot-gauge__progress",cx:"24",cy:"24",r:"20",fill:"none",strokeWidth:"4",strokeDasharray:a,strokeDashoffset:s,strokeLinecap:"round",style:{stroke:o}})),(0,t.createElement)("div",{className:"wpseopilot-gauge__value",style:{color:o}},e))},d=({seoMeta:e,updateMeta:l,seoScore:o,effectiveTitle:a,effectiveDescription:i,postUrl:r,postTitle:p,featuredImage:d,hasChanges:w})=>{const[u,g]=(0,s.useState)("general"),h=(e.title||"").length,E=(e.description||"").length,v=()=>0===h?"empty":h<30?"short":h>60?"long":"good",f=()=>0===E?"empty":E<70?"short":E>160?"long":"good";return(0,t.createElement)("div",{className:"wpseopilot-editor-panel"},(0,t.createElement)("div",{className:"wpseopilot-score-header"},(0,t.createElement)(m,{score:o?.score||0,level:o?.level||"poor"}),(0,t.createElement)("div",{className:"wpseopilot-score-info"},(0,t.createElement)("div",{className:"wpseopilot-score-label"},"SEO Score"),(0,t.createElement)("div",{className:"wpseopilot-score-status"},o?.issues?.length>0?`${o.issues.length} issue${1!==o.issues.length?"s":""} found`:"Looking good!"))),(0,t.createElement)("div",{className:"wpseopilot-tabs"},(0,t.createElement)("button",{type:"button",className:"wpseopilot-tab "+("general"===u?"active":""),onClick:()=>g("general")},"General"),(0,t.createElement)("button",{type:"button",className:"wpseopilot-tab "+("advanced"===u?"active":""),onClick:()=>g("advanced")},"Advanced"),(0,t.createElement)("button",{type:"button",className:"wpseopilot-tab "+("social"===u?"active":""),onClick:()=>g("social")},"Social")),"general"===u&&(0,t.createElement)("div",{className:"wpseopilot-tab-content"},(0,t.createElement)("div",{className:"wpseopilot-preview-section"},(0,t.createElement)("label",{className:"wpseopilot-section-label"},"Search Preview"),(0,t.createElement)(c,{title:a,description:i,url:r})),(0,t.createElement)("div",{className:"wpseopilot-field"},(0,t.createElement)(n.TextControl,{label:"Focus Keyphrase",value:e.focus_keyphrase,onChange:e=>l("focus_keyphrase",e),placeholder:"Enter your target keyword",help:"The main keyword you want this page to rank for"})),(0,t.createElement)("div",{className:"wpseopilot-field"},(0,t.createElement)("div",{className:"wpseopilot-field-header"},(0,t.createElement)("label",null,"SEO Title"),(0,t.createElement)("span",{className:`wpseopilot-char-count ${v()}`},h,"/",60)),(0,t.createElement)(n.TextControl,{value:e.title,onChange:e=>l("title",e),placeholder:p||"Enter SEO title"}),(0,t.createElement)("div",{className:"wpseopilot-progress-bar"},(0,t.createElement)("div",{className:`wpseopilot-progress-fill ${v()}`,style:{width:`${Math.min(h/60*100,100)}%`}}))),(0,t.createElement)("div",{className:"wpseopilot-field"},(0,t.createElement)("div",{className:"wpseopilot-field-header"},(0,t.createElement)("label",null,"Meta Description"),(0,t.createElement)("span",{className:`wpseopilot-char-count ${f()}`},E,"/",160)),(0,t.createElement)(n.TextareaControl,{value:e.description,onChange:e=>l("description",e),placeholder:"Enter meta description",rows:3}),(0,t.createElement)("div",{className:"wpseopilot-progress-bar"},(0,t.createElement)("div",{className:`wpseopilot-progress-fill ${f()}`,style:{width:`${Math.min(E/160*100,100)}%`}}))),o?.issues?.length>0&&(0,t.createElement)("div",{className:"wpseopilot-issues"},(0,t.createElement)("label",{className:"wpseopilot-section-label"},"Analysis"),(0,t.createElement)("ul",{className:"wpseopilot-issues-list"},o.issues.slice(0,5).map((e,l)=>(0,t.createElement)("li",{key:l,className:`wpseopilot-issue wpseopilot-issue--${e.severity||"warning"}`},(0,t.createElement)("span",{className:"wpseopilot-issue-icon"},"error"===e.severity?"!":"?"),(0,t.createElement)("span",{className:"wpseopilot-issue-text"},e.message)))))),"advanced"===u&&(0,t.createElement)("div",{className:"wpseopilot-tab-content"},(0,t.createElement)("div",{className:"wpseopilot-field"},(0,t.createElement)(n.TextControl,{label:"Canonical URL",value:e.canonical,onChange:e=>l("canonical",e),placeholder:r,help:"Leave empty to use the default URL",type:"url"})),(0,t.createElement)("div",{className:"wpseopilot-robots-section"},(0,t.createElement)("label",{className:"wpseopilot-section-label"},"Search Engine Visibility"),(0,t.createElement)(n.ToggleControl,{label:"Hide from search results",help:"Add noindex meta tag to prevent indexing",checked:e.noindex,onChange:e=>l("noindex",e)}),(0,t.createElement)(n.ToggleControl,{label:"Don't follow links",help:"Add nofollow meta tag to links on this page",checked:e.nofollow,onChange:e=>l("nofollow",e)})),(0,t.createElement)("div",{className:"wpseopilot-robots-preview"},(0,t.createElement)("label",{className:"wpseopilot-section-label"},"Robots Meta"),(0,t.createElement)("code",{className:"wpseopilot-robots-code"},e.noindex||e.nofollow?`${e.noindex?"noindex":"index"}, ${e.nofollow?"nofollow":"follow"}`:"index, follow (default)"))),"social"===u&&(0,t.createElement)("div",{className:"wpseopilot-tab-content"},(0,t.createElement)("div",{className:"wpseopilot-social-preview"},(0,t.createElement)("label",{className:"wpseopilot-section-label"},"Social Preview"),(0,t.createElement)("div",{className:"wpseopilot-social-card"},(0,t.createElement)("div",{className:"wpseopilot-social-image"},e.og_image||d?(0,t.createElement)("img",{src:e.og_image||d,alt:""}):(0,t.createElement)("div",{className:"wpseopilot-social-placeholder"},(0,t.createElement)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none"},(0,t.createElement)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,t.createElement)("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),(0,t.createElement)("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})),(0,t.createElement)("span",null,"No image set"))),(0,t.createElement)("div",{className:"wpseopilot-social-content"},(0,t.createElement)("div",{className:"wpseopilot-social-url"},new URL(r).hostname),(0,t.createElement)("div",{className:"wpseopilot-social-title"},a),(0,t.createElement)("div",{className:"wpseopilot-social-desc"},i||"No description available")))),(0,t.createElement)("div",{className:"wpseopilot-field"},(0,t.createElement)(n.TextControl,{label:"Social Image URL",value:e.og_image,onChange:e=>l("og_image",e),placeholder:"https://...",help:"Override the featured image for social sharing (1200x630 recommended)",type:"url"}),!e.og_image&&d&&(0,t.createElement)("p",{className:"wpseopilot-field-note"},"Using featured image as fallback")),(0,t.createElement)(n.Button,{variant:"secondary",className:"wpseopilot-media-button",onClick:()=>{const e=wp.media({title:"Select Social Image",button:{text:"Use Image"},multiple:!1});e.on("select",()=>{const t=e.state().get("selection").first().toJSON();l("og_image",t.url)}),e.open()}},(0,t.createElement)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"6px"}},(0,t.createElement)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,t.createElement)("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),(0,t.createElement)("path",{d:"M21 15l-5-5L5 21",stroke:"currentColor",strokeWidth:"2"})),"Select Image")))},w=()=>(0,t.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,t.createElement)("path",{d:"M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z",fill:"currentColor"}));(0,l.registerPlugin)("wpseopilot",{render:()=>{const[e,l]=(0,s.useState)({title:"",description:"",canonical:"",noindex:!1,nofollow:!1,og_image:"",focus_keyphrase:""}),[i,n]=(0,s.useState)(null),[c,p]=(0,s.useState)(!1),[m,u]=(0,s.useState)(!1),{postId:g,postTitle:h,postExcerpt:E,postContent:v,postType:f,postSlug:N,featuredImage:b}=(0,a.useSelect)(e=>{const t=e("core/editor"),l=t.getCurrentPost(),o=t.getEditedPostAttribute("featured_media");let a="";if(o){const t=e("core").getMedia(o);t&&(a=t.source_url)}return{postId:t.getCurrentPostId(),postTitle:t.getEditedPostAttribute("title")||"",postExcerpt:t.getEditedPostAttribute("excerpt")||"",postContent:t.getEditedPostContent()||"",postType:t.getCurrentPostType(),postSlug:l?.slug||"",featuredImage:a}},[]),{editPost:_}=(0,a.useDispatch)("core/editor");(0,s.useEffect)(()=>{if(!g||!f)return;const e={post:"posts",page:"pages",attachment:"media"}[t=f]||t;var t;r()({path:`/wp/v2/${e}/${g}`}).then(e=>{if(e.meta&&e.meta._wpseopilot_meta){const t=e.meta._wpseopilot_meta;l({title:t.title||"",description:t.description||"",canonical:t.canonical||"",noindex:"1"===t.noindex,nofollow:"1"===t.nofollow,og_image:t.og_image||"",focus_keyphrase:t.focus_keyphrase||""})}}).catch(()=>{})},[g,f]),(0,s.useEffect)(()=>{if(!g)return;const e=setTimeout(()=>{r()({path:`/wpseopilot/v2/audit/post/${g}`}).then(e=>{e.success&&e.data&&n(e.data)}).catch(()=>{})},500);return()=>clearTimeout(e)},[g,e,h,v]);const y=(0,s.useCallback)((t,o)=>{l(e=>({...e,[t]:o})),u(!0);const a={...e,[t]:o},s={title:a.title,description:a.description,canonical:a.canonical,noindex:a.noindex?"1":"",nofollow:a.nofollow?"1":"",og_image:a.og_image,focus_keyphrase:a.focus_keyphrase};_({meta:{_wpseopilot_meta:s}})},[e,_]),x=e.title||h||"Untitled",k=e.description||E||"",C=window.location.origin,S=N?`${C}/${N}/`:C;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.PluginSidebarMoreMenuItem,{target:"wpseopilot-sidebar",icon:(0,t.createElement)(w,null)},"WP SEO Pilot"),(0,t.createElement)(o.PluginSidebar,{name:"wpseopilot-sidebar",title:"WP SEO Pilot",icon:(0,t.createElement)(w,null)},(0,t.createElement)(d,{seoMeta:e,updateMeta:y,seoScore:i,effectiveTitle:x,effectiveDescription:k,postUrl:S,postTitle:h,featuredImage:b,hasChanges:m})))},icon:(0,t.createElement)(w,null)})})();