# WP SEO Pilot - Duplicate Title Tag Bug Report

## Issue Summary
WP SEO Pilot is generating a duplicate `<title>` tag in the HTML `<head>` section, resulting in two title tags being rendered on every page.

## Environment
- **WordPress Version**: (check your version)
- **WP SEO Pilot Version**: (check your version)
- **Theme**: BuildItDesign Custom Theme
- **PHP Version**: (check your version)
- **Environment**: Local development (builditdesign.local)

## Problem Description

When viewing the page source, two `<title>` tags appear in the `<head>` section:

```html
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FIRST TITLE TAG (WordPress Default) -->
    <title>Expertise | builditdesign</title>

    <meta name='robots' content='max-image-preview:large' />

    <!-- SECOND TITLE TAG (WP SEO Pilot) -->
    <title>Expert SEO, Brand Strategy, and WordPress Development Services | BuildItDesign</title>

    <meta name="description" content="Explore our specialized services..." />
    <link rel="canonical" href="http://builditdesign.local/expertise" />
</head>
```

**Expected Behavior**: Only ONE `<title>` tag should be present - the one generated by WP SEO Pilot with the SEO-optimized content.

**Actual Behavior**: TWO `<title>` tags are rendered - WordPress's default title AND WP SEO Pilot's optimized title.

## Impact
- **SEO Issues**: Duplicate title tags confuse search engines and violate HTML5 standards
- **Validation Errors**: HTML validation fails due to multiple title elements
- **Unpredictable Behavior**: Browsers may use either title tag, leading to inconsistent results
- **Search Engine Penalties**: Google may penalize sites with invalid HTML structure

## Steps to Reproduce
1. Install WP SEO Pilot plugin
2. Create a page with custom SEO title in WP SEO Pilot settings
3. View the page source code
4. Observe two `<title>` tags in the `<head>` section

## Theme-Side Mitigation Attempts

We have attempted multiple approaches to prevent WordPress from generating its default title tag, allowing WP SEO Pilot to be the sole title generator. None of these have resolved the issue:

### 1. Removed `add_theme_support('title-tag')`
**File**: `includes/theme-setup.php`

We removed the WordPress title-tag theme support entirely:

```php
// REMOVED THIS LINE:
// add_theme_support('title-tag');
```

**Result**: Duplicate still occurs

### 2. Removed Custom Title Filter
**File**: `includes/seo-integration.php`

We removed our custom `wpseopilot_title` filter to avoid any conflicts:

```php
// REMOVED THIS ENTIRE FUNCTION:
// add_filter( 'wpseopilot_title', 'bidt_theme_seo_title', 10, 2 );
```

**Result**: Duplicate still occurs

### 3. Added Multiple Title Prevention Hooks
**File**: `functions.php` (lines 25-32)

We added three layers of title prevention at the earliest possible point in theme loading:

```php
// Disable WordPress default title tag - WP SEO Pilot handles all titles
add_filter( 'pre_get_document_title', '__return_empty_string', 1 );
remove_action( 'wp_head', '_wp_render_title_tag', 1 );

// Forcefully prevent title-tag theme support
add_action( 'after_setup_theme', function() {
	remove_theme_support( 'title-tag' );
}, 999 );
```

**Result**: Duplicate still occurs

### 4. Additional Troubleshooting Steps Taken
- ✅ Cleared WordPress permalinks (Settings → Permalinks → Save Changes)
- ✅ Hard refreshed browser (Ctrl+Shift+R)
- ✅ Cleared all caching (browser cache and WordPress cache)
- ✅ Verified no hardcoded `<title>` tags in theme template files
- ✅ Confirmed `header.php` only contains `<?php wp_head(); ?>`

**Result**: Duplicate persists in all cases

## Root Cause Analysis

Based on our extensive testing, the issue appears to be within WP SEO Pilot itself. Here's why:

### Theory 1: Plugin Not Preventing WordPress Default Title
WP SEO Pilot may not be properly preventing WordPress's built-in title generation. When a theme declares `add_theme_support('title-tag')`, WordPress automatically outputs a title tag via the `_wp_render_title_tag()` function hooked to `wp_head` at priority 1.

**Expected Plugin Behavior**: WP SEO Pilot should:
1. Remove the `_wp_render_title_tag` action from `wp_head`
2. Add its own title tag rendering function
3. Ensure only ONE title tag is output

**Current Behavior**: WP SEO Pilot appears to be adding its own title tag WITHOUT removing WordPress's default title rendering, resulting in both being output.

### Theory 2: Incorrect Hook Priority
WP SEO Pilot may be hooking into `wp_head` at the wrong priority, causing its title to be added AFTER WordPress's default title has already been rendered.

### Theory 3: Missing Theme Support Check
WP SEO Pilot may not be checking if the theme has `title-tag` support enabled, and blindly outputting its own title regardless of whether WordPress is also outputting one.

## Recommended Fix for Plugin Developer

The plugin should implement the following logic:

```php
/**
 * Initialize title tag handling
 */
function wpseopilot_init_title_handling() {
	// Remove WordPress default title tag generation
	remove_action( 'wp_head', '_wp_render_title_tag', 1 );

	// Remove theme support for title-tag to prevent conflicts
	remove_theme_support( 'title-tag' );

	// Add our own title tag rendering at the same priority
	add_action( 'wp_head', 'wpseopilot_render_title_tag', 1 );
}
add_action( 'after_setup_theme', 'wpseopilot_init_title_handling', 999 );

/**
 * Render WP SEO Pilot title tag
 */
function wpseopilot_render_title_tag() {
	if ( ! function_exists( 'wpseopilot_get_title' ) ) {
		return;
	}

	$title = wpseopilot_get_title();

	if ( empty( $title ) ) {
		return;
	}

	echo '<title>' . esc_html( $title ) . '</title>' . "\n";
}

/**
 * Prevent WordPress from generating document title
 */
add_filter( 'pre_get_document_title', '__return_empty_string', 1 );
```

## Additional Context

### Working SEO Elements
The following WP SEO Pilot features ARE working correctly:
- ✅ Meta description tags
- ✅ Canonical URLs
- ✅ Open Graph tags
- ✅ Robots meta tags
- ✅ JSON-LD structured data
- ✅ Breadcrumbs
- ✅ Sitemap generation

**Only the title tag is duplicated.**

### Theme Architecture
Our theme follows WordPress best practices:
- Component-based architecture with modular template parts
- Full WordPress Coding Standards compliance
- Proper escaping and sanitization
- Plugin function existence checks before use
- Graceful degradation when plugins are inactive

### Theme Files Structure
```
builditdesign-theme/
├── functions.php              # Theme entry point (title prevention code added here)
├── header.php                 # Contains only <?php wp_head(); ?>
├── includes/
│   ├── theme-setup.php       # WordPress features (title-tag support REMOVED)
│   ├── seo-integration.php   # WP SEO Pilot integration (custom title filter REMOVED)
│   └── [other includes]
└── [other theme files]
```

## Comparison with Other SEO Plugins

For reference, other major SEO plugins handle this correctly:

### Yoast SEO
```php
// Yoast removes WordPress default title and outputs its own
remove_action( 'wp_head', '_wp_render_title_tag', 1 );
add_action( 'wp_head', array( $this, 'title' ), 1 );
```

### Rank Math
```php
// Rank Math removes theme support and handles title completely
remove_theme_support( 'title-tag' );
add_action( 'wp_head', array( $this, 'render_title' ), 1 );
```

### All in One SEO Pack
```php
// AIOSEO removes WordPress title rendering
remove_action( 'wp_head', '_wp_render_title_tag', 1 );
```

## Request for Plugin Developer

Could you please:

1. **Verify** that WP SEO Pilot is properly removing WordPress's default title tag generation
2. **Check** the hook priorities for title tag rendering in the plugin
3. **Confirm** that the plugin actively prevents `_wp_render_title_tag()` from executing
4. **Test** with a fresh WordPress installation to reproduce the issue
5. **Implement** the recommended fix above or similar logic to ensure only one title tag is output

## Testing Instructions for Fix Verification

Once fixed, we should see:

### Before (Current - Broken)
```html
<head>
    <title>Page Title | Site Name</title>  <!-- WordPress default -->
    <title>SEO Optimized Page Title | Site Name</title>  <!-- WP SEO Pilot -->
</head>
```

### After (Expected - Fixed)
```html
<head>
    <title>SEO Optimized Page Title | Site Name</title>  <!-- WP SEO Pilot only -->
</head>
```

## Validation
The fix can be validated by:
1. Viewing page source and counting `<title>` tags (should be exactly 1)
2. Running HTML validator: https://validator.w3.org/
3. Checking Google Search Console for HTML improvements
4. Using SEO tools like Screaming Frog to verify single title tag

## Contact Information
- **Theme**: BuildItDesign Custom Theme v1.1.0
- **Developer**: [Your Name/Company]
- **Report Date**: January 8, 2026
- **Priority**: High (SEO Impact)

---

## Appendix: Debug Information

To help diagnose this issue, here's what we see when viewing the HTML source:

```html
<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Expertise | builditdesign</title>  <!-- DUPLICATE 1 -->
    <meta name='robots' content='max-image-preview:large' />
<title>Expert SEO, Brand Strategy, and WordPress Development Services | BuildItDesign</title>  <!-- DUPLICATE 2 -->
<meta name="description" content="Explore our specialized services including technical SEO, headless WordPress builds, data driven design, and conversion focused brand identity. Built for teams that want results." />
<link rel="canonical" href="http://builditdesign.local/expertise" />
```

The first title follows the WordPress pattern: `{Page Title} | {Site Name}`
The second title follows the WP SEO Pilot pattern: `{Custom SEO Title}`

This confirms two separate title generation systems are running simultaneously.

---

**Thank you for looking into this issue. Please let us know if you need any additional information or debug output to resolve this duplicate title tag problem.**
